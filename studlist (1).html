<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editable Student List</title>
    <style>
      h2{
        text-align: center;
      }
      table {
        width: 40%;
        border-collapse: collapse;
      }
      #studinfo {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: 1fr;
        grid-column-gap: 0px;
        grid-row-gap: 0px;
      }

      #studinfo-input {
        grid-area: 1 / 1 / 2 / 2;
        margin: 0 auto 2% 5%;
      }

      #output-section {
        grid-area: 1 / 2 / 2 / 3;
        margin: 0  2% 2% auto; 
      }

      th,
      td {
        margin: 2%;
        border: 1px solid black;
      }

     
      #data-output td {
        padding: auto;
      }

      .hidden {
        display: none;
      }
      #subject{

      }
    </style>
  </head>

  <body>
    <div id="root">
      <h2>Student List</h2>
      <div id="studinfo">
        <div id="studinfo-input">
          <h3>Input Table</h3>
          <table border="1">
            <thead>
              <tr>
                <th>Sr. No.</th>
                <th>Roll No</th>
                <th>Name</th>
                <th>Grade</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="data-output">
              <!-- Dynamic rows will be added here -->
            </tbody>
          </table>
          <div style="margin-top: 10px">
            <button onclick="addStudent()">Add Student</button>
            <button onclick="saveJson()" style="margin-left: 10px">
              Save JSON
            </button>
            <input
              type="file"
              onchange="loadJson(event)"
              style="margin-left: 10px"
            />
            <button onclick="generateOutput()" style="margin-left: 10px">
              Generate Output
            </button>
          </div>
        </div>

        <div id="output-section" class="hidden">
          <h3>Output Table</h3>
          <table border="1">
            <thead>
              <tr>
                <th>Sr. No.</th>
                <th>Roll No</th>
                <th>Name</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody id="output-table">
              <!-- Dynamic output rows will be added here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  

        <div id="output-section" class="hidden">
          <h3>Output Table</h3>
          <table border="1">
            <thead>
              <tr>
                <th>Sr. No.</th>
                <th>Roll No</th>
                <th>Name</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody id="output-table">
              <!-- Dynamic output rows will be added here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

   

    <script src="./sql.js"></script>
    <script>
      var db;
      initSqlJs().then((SQL) => {
        db = new SQL.Database();
        db.exec("PRAGMA foreign_keys = on;");
        db.exec(
          "CREATE TABLE studinfo (id int, rollno text primary key, stud_name text, grade text);"
        );
        console.log(db.exec("select * from studinfo;"));
        db.exec(
          "CREATE TABLE subject(subno int primary key, subname text, guidename text);"
        );
        db.exec(
          "CREATE TABLE stud_sub(rollno text, subno text, FOREIGN KEY (rollno) references studinfo (rollno), FOREIGN KEY (subno) references subject (subno), PRIMARY KEY(rollno, subno));"
        );
        // db.exec("insert into subject values('2001', 'Assembly prog', 'Nitin Patil');");
        console.log(db.exec("SELECT * FROM subject;"));
        // db.exec(`INSERT INTO studinfo VALUES(0, "23112036", "Shashi", "B");`);
        // db.run("insert into stud_sub values('23112036', '2001');");
        db.exec(`insert into studinfo values(0, '', '', '');`);
        console.log(db.exec("SELECT * FROM stud_sub;"));

        // Initial render
        renderTable();
      });

      function renderTable() {
        const res = db.exec("SELECT * FROM studinfo;");

        const tableBody = document.getElementById("data-output");
        tableBody.innerHTML = "";
        if (res[0]) {
          res[0].values.forEach((student, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
          <td>${index + 1}</td>
          <td><input type="text" name="rollno" value="${
            student[1]
          }" oninput="handleInputChange(${student[0]}, event)" /></td>
          <td><input type="text" name="stud_name" value="${
            student[2]
          }" oninput="handleInputChange(${student[0]}, event)" /></td>
          <td><input type="text" name="grade" value="${
            student[3]
          }" oninput="handleInputChange(${student[0]}, event)" /></td>
          <td><button onclick="removeStudent(${student[0]})">Remove</button>
        `;

            tableBody.appendChild(row);
          });
        }
      }

      function handleInputChange(index, event) {
        const { name, value } = event.target;
        const query = `UPDATE studinfo SET ${name} = '${value}' WHERE id = ${index};`;
        db.exec(query);
      }

      function addStudent() {
        const res = db.exec("SELECT * from studinfo;");
        db.exec(
          `INSERT INTO studinfo VALUES(${
            res[0] ? res[0].values.length + 1 : 0
          }, "", "", "");`
        );
        renderTable();
      }

      function removeStudent(index) {
        db.exec(`DELETE FROM studinfo where id = ${index}`);
        renderTable();
      }

      function saveJson() {
        const res = db.exec("SELECT * FROM studinfo");
        const jsonData = JSON.stringify(res);
        const blob = new Blob([jsonData], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "student_data.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function loadJson(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        db.exec("DELETE from studinfo;");
        reader.onload = (e) => {
          res = JSON.parse(e.target.result);
          res[0].values.forEach((student) => {
            db.exec(
              `INSERT into studinfo values(${student[0]}, '${student[1]}', '${student[2]}', '${student[3]}')`
            );
          });
          renderTable();
        };
        reader.readAsText(file);
      }

      function generateOutput() {
        const outputSection = document.getElementById("output-section");
        const outputTable = document.getElementById("output-table");
        outputTable.innerHTML = "";
        const res = db.exec("SELECT * FROM studinfo;");
        if (res[0]) {
          res[0].values.forEach((student, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
          <td>${index + 1}</td>
          <td><input type="text" name="rollno" value="${
            student[1]
          }" readonly /></td>
          <td><input type="text" name="stud_name" value="${
            student[2]
          }" readonly /></td>
          <td><input type="text" name="grade" value="${
            student[3]
          }" readonly /></td>
        `;
            outputTable.appendChild(row);
          });
        }
        outputSection.classList.remove("hidden");
      }
      </script>
  </body>
</html>

