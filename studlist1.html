<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editable Student and Subject List</title>
  <style>
    h2 {
      text-align: center;
    }
    table {
      width: 40%;
      border-collapse: collapse;
    }
    #studinfo, #subinfo {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 1fr;
      grid-column-gap: 0px;
      grid-row-gap: 0px;
    }
    #studinfo-input, #subinfo-input {
      grid-area: 1 / 1 / 2 / 2;
      margin: 0 auto 2% 5%;
    }
    #student-output-section, #subject-output-section {
      grid-area: 1 / 2 / 2 / 3;
      margin: 0 2% 2% auto;
    }
    th, td {
      margin: 2%;
      border: 1px solid black;
    }
    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div id="root">
    <h2>Student List</h2>
    <div id="studinfo">
      <div id="studinfo-input">
        <h3>Input Table</h3>
        <table border="1">
          <thead>
            <tr>
              <th>Sr. No.</th>
              <th>Roll No</th>
              <th>Name</th>
              <th>Grade</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="student-data-output">
            <!-- Dynamic rows will be added here -->
          </tbody>
        </table>
        <div style="margin-top: 10px">
          <button onclick="addStudent()">Add Student</button>
          <button onclick="saveStudentJson()" style="margin-left: 10px">Save JSON</button>
          <input type="file" onchange="loadStudentJson(event)" style="margin-left: 10px" />
          <button onclick="generateStudentOutput()" style="margin-left: 10px">Generate Output</button>
        </div>
      </div>
      <div id="student-output-section" class="hidden">
        <h3>Output Table</h3>
        <table border="1">
          <thead>
            <tr>
              <th>Sr. No.</th>
              <th>Roll No</th>
              <th>Name</th>
              <th>Grade</th>
            </tr>
          </thead>
          <tbody id="student-output-table">
            <!-- Dynamic output rows will be added here -->
          </tbody>
        </table>
      </div>
    </div>

    <h2>Subject List</h2>
    <div id="subinfo">
      <div id="subinfo-input">
        <h3>Input Table</h3>
        <table border="1">
          <thead>
            <tr>
              <th>Sr. No.</th>
              <th>Subject Code</th>
              <th>Name</th>
              <th>Guide Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="subject-data-output">
            <!-- Dynamic rows will be added here -->
          </tbody>
        </table>
        <div style="margin-top: 10px">
          <button onclick="addSubject()">Add Subject</button>
          <button onclick="saveSubjectJson()" style="margin-left: 10px">Save JSON</button>
          <input type="file" onchange="loadSubjectJson(event)" style="margin-left: 10px" />
          <button onclick="generateSubjectOutput()" style="margin-left: 10px">Generate Output</button>
        </div>
      </div>
      <div id="subject-output-section" class="hidden">
        <h3>Output Table</h3>
        <table border="1">
          <thead>
            <tr>
              <th>Sr. No.</th>
              <th>Subject Code</th>
              <th>Name</th>
              <th>Guide Name</th>
            </tr>
          </thead>
          <tbody id="subject-output-table">
            <!-- Dynamic output rows will be added here -->
          </tbody>
        </table>
      </div>
    </div>
    

  </div>

  <script src="./sql.js"></script>
  <script>
    var db;
    initSqlJs().then((SQL) => {
      db = new SQL.Database();
      db.exec("PRAGMA foreign_keys = on;");
      db.exec("CREATE TABLE studinfo (id int, rollno text primary key, stud_name text, grade text);");
      db.exec("CREATE TABLE subject (id int,subno text primary key, subname text, guidename text);");
      db.exec("CREATE TABLE stud_sub (rollno text, subno text, FOREIGN KEY (rollno) references studinfo (rollno), FOREIGN KEY (subno) references subject (subno), PRIMARY KEY(rollno, subno));");
      db.exec(`INSERT INTO studinfo VALUES(0, '', '', '');`);
      db.exec(`INSERT INTO subject VALUES(0, '', '', '');`);
      
      renderStudinfoTable();
      renderSubjectTable();
   
    });

    function renderStudinfoTable() {
      const res = db.exec("SELECT * FROM studinfo;");
      const tableBody = document.getElementById("student-data-output");
      tableBody.innerHTML = "";
      if (res[0]) {
        res[0].values.forEach((student, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td><input type="text" name="rollno" value="${student[1]}" oninput="handleStudentInputChange(${student[0]}, event)" /></td>
            <td><input type="text" name="stud_name" value="${student[2]}" oninput="handleStudentInputChange(${student[0]}, event)" /></td>
            <td><input type="text" name="grade" value="${student[3]}" oninput="handleStudentInputChange(${student[0]}, event)" /></td>
            <td><button onclick="removeStudent(${student[0]})">Remove</button></td>
          `;
          tableBody.appendChild(row);
        });
      }
    }

    function handleStudentInputChange(index, event) {
      const { name, value } = event.target;
      const query = `UPDATE studinfo SET ${name} = '${value}' WHERE id = ${index};`;
      db.exec(query);
    }

    function addStudent() {
      const res = db.exec("SELECT * FROM studinfo;");
      db.exec(`INSERT INTO studinfo VALUES(${res[0] ? res[0].values.length + 1 : 0}, '', '', '');`);
      renderStudinfoTable();
    }

    function removeStudent(index) {
      db.exec(`DELETE FROM studinfo WHERE id = ${index}`);
      renderStudinfoTable();
    }

    function saveStudentJson() {
      const res = db.exec("SELECT * FROM studinfo");
      const jsonData = JSON.stringify(res);
      const blob = new Blob([jsonData], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "student_data.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function loadStudentJson(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const res = JSON.parse(e.target.result);
        db.exec("DELETE FROM studinfo;");
        res[0].values.forEach((student) => {
          db.exec(`INSERT INTO studinfo VALUES('${student[0]}', '${student[1]}', '${student[2]}','${student[3]}')`);
        });
        renderStudinfoTable();
      };
      reader.readAsText(file);
    }

    function generateStudentOutput() {
      const outputSection = document.getElementById("student-output-section");
      const outputTable = document.getElementById("student-output-table");
      outputTable.innerHTML = "";
      const res = db.exec("SELECT * FROM studinfo;");
      if (res[0]) {
        res[0].values.forEach((student, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td><input type="text" name="rollno" value="${student[1]}" readonly /></td>
            <td><input type="text" name="stud_name" value="${student[2]}" readonly /></td>
            <td><input type="text" name="grade" value="${student[3]}" readonly /></td>
          `;
          outputTable.appendChild(row);
        });
      }
      outputSection.classList.remove("hidden");
    }

    function renderSubjectTable() {
      const res = db.exec("SELECT * FROM subject;");
      const tableBody = document.getElementById("subject-data-output");
      tableBody.innerHTML = "";
      if (res[0]) {
        res[0].values.forEach((subject, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td><input type="text" name="subno" value="${subject[1]}"oninput="handleSubjectInputChange(${subject[0]}, event)"/></td>
            <td><input type="text" name="subname" value="${subject[2]}" oninput="handleSubjectInputChange(${subject[0]}, event)" /></td>
            <td><input type="text" name="guidename" value="${subject[3]}" oninput="handleSubjectInputChange(${subject[0]}, event)" /></td>
            <td><button onclick="removeSubject(${subject[0]})">Remove</button></td>
          `;
          tableBody.appendChild(row);
        });
      }
    }

    function handleSubjectInputChange(index, event) {
      const { name, value } = event.target;
      const query = `UPDATE subject SET ${name} = '${value}' WHERE id = ${index};`;
      db.exec(query);
    }
    function addSubject() {
      const res = db.exec("SELECT * FROM subject;");
      db.exec(`INSERT INTO subject VALUES(${res[0] ? res[0].values.length + 1 : 0}, '', '','');`);
      renderSubjectTable();
    }
    // function addSubject() {
    //   const res = db.exec("SELECT * FROM subject;");
    //   db.exec(`INSERT INTO subject VALUES(${res[0].values.length + 1 }, '', '');`);
    //   renderSubjectTable();
    // }

    function removeSubject(index) {
      db.exec(`DELETE FROM subject WHERE id = ${index}`);
      renderSubjectTable();
    }

    function saveSubjectJson() {
      const res = db.exec("SELECT * FROM subject");
      const jsonData = JSON.stringify(res);
      const blob = new Blob([jsonData], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "subject_data.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function loadSubjectJson(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const res = JSON.parse(e.target.result);
        db.exec("DELETE FROM subject;");
        res[0].values.forEach((subject) => {
          db.exec(`INSERT INTO subject VALUES(${subject[0]}, '${subject[1]}', '${subject[2]}','${subject[3]}')`);
        });
        renderSubjectTable();
      };
      reader.readAsText(file);
    }

    function generateSubjectOutput() {
  const outputSection = document.getElementById("subject-output-section");
  const outputTable = document.getElementById("subject-output-table");
  outputTable.innerHTML = "";
  const res = db.exec("SELECT * FROM subject;");
  if (res[0]) {
    res[0].values.forEach((subject, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${index + 1}</td>
        <td><input type="text" name="subno" value="${subject[1]}" readonly /></td>
        <td><input type="text" name="subname" value="${subject[2]}" readonly /></td>
        <td><input type="text" name="guidename" value="${subject[3]}" readonly /></td>
      `;
      outputTable.appendChild(row);
    });
  }
  outputSection.classList.remove("hidden");
}


  </script>
</body>
</html>



 

